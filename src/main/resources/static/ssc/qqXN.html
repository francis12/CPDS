<!DOCTYPE HTML>
<html>
  
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link type="text/css" rel="stylesheet" href="style.css" />
</head>

<body style="padding:0" onload="init()">
<div id="condition" style="display:inline;width:30%;float:left;">
    <select onchange="prizeOnchange()" id="prizeSelect">
        <option value="77TJ">
            奇趣
        </option>
        <option value="QQ09">
            QQ09
        </option>
    </select>
    <select onchange="wfOnchange()" id="wfselectionId">
        <option value="ge">
            个
        </option>
        <option value="shi">
            十
        </option>
        <option value="bai">
            百
        </option>
        <option value="qian">
            千
        </option>
        <option value="wan">
            万
        </option>
    </select>
    最近N期，N=
    <!--<input type="text" id="limitValue" name="value" value="60" onchange="refreshMissedData()"/>
    -->
    <select onchange="wfOnchange()" id="limitValue">
        <option value="200">
            200
        </option>
        <option value="30">
            30
        </option>
        <option value="100">
            100
        </option>
        <option value="60">
           60
        </option>

        <option value="300">
            300
        </option>

        <option value="1000">
            1000
        </option>

    </select>
</div>
<div style="text-align:center;;float:left;margin:10px 0px">
            <span>
                <input type="checkbox" id="soundSwitch" onclick="SoundSwitch_OnClick()"
                       checked="checked" style="font-size:50px;" />
                自动播放
            </span>
    <div id="prize" style="color:#F00;font-size:30px;display:inline">
    </div>
</div>
<audio src="audio/toast.mp3" id="toastMp3" controls="controls" loop="false" hidden="true">
</audio>
<div id="bdtts_div_id">
    <audio id="tts_autio_id" autoplay="autoplay">
        <source id="tts_source_id" src="" type="audio/mpeg">
        <embed id="tts_embed_id" height="0" width="0" src="">
    </audio>
</div>
<div id="mytime" style="color:#F00;font-size:26px;clear:both">
</div>


<div style="">
    <div style="float:left;width:76%">
        <div id="table">
        </div>
    </div>
    <div style="float:left;width:23%" id="content">
        <h2>
                    <span class="issue full-size">
                        期号
                    </span>
            <span class="codes full-size">
                        开奖
                    </span>
            <span class="adjusts full-size">
                        波动
                    </span>
        </h2>
        <div class="history-codes" id="history-codes">
        </div>
    </div>
</div>
<script src="jquery-1.10.1.min.js">
</script>
<script src="echarts.js">
</script>
<script src="soundmanager2.js">
</script>
<script src="toos.js">
</script>
<script src="config.js">
</script>
<script type="text/javascript">
    var wfType;
    var toastNum=20;
    var curPrize;
    var prizeType;
    function init() {
        wfType = "ge";
        prizeType = "77TJ"
        $("#wfselectionId").val("ge");
        $("#prizeSelect").val("77TJ");
        $('#soundSwitch').attr('checked',false)
        //移除 checked 状态
        isSoundSwitchOn = false;
        var nowtime2 = new Date();
        var year = nowtime2.getFullYear();
        var month = nowtime2.getMonth() + 1;
        if (month < 10) {
            month = "0" + month;
        }
        var date = nowtime2.getDate();
        if (date < 10) {
            date = "0" + date;
        }
        $("#dateText").val("" + year + month + date);
    }
    function wfOnchange() {
        wfType = $("#wfselectionId").val();
        refreshMissedData();
        refreshPrizeHis();
        //console.log(this);
    }
    function prizeOnchange() {
        prizeType = $("#prizeSelect").val();
        refreshMissedData();
        refreshPrizeHis();
        //console.log(this);
    }
    function showTime() {
        nowtime = new Date();
        year = nowtime.getFullYear();
        month = nowtime.getMonth() + 1;
        date = nowtime.getDate();
        document.getElementById("mytime").innerText = year + "年" + month + "月" + date + "日 " + nowtime.toLocaleTimeString();
    }

    setInterval("showTime()", 1000);
    var isPreMatch = false;
    var prizeL1;
    var prizeL2;
    function refreshPrizeHis() {
        var limit = $("#limitValue").val();
        $.ajax({
            url: staticUrl + "/prize/getLatestPrize?lotteryCode=TCFFC&limit=" + limit  + "&prizeType=" + prizeType,
            success: function(responseText) {
                //请求成功时处理
                //var responseText = eval('(' + responseText + ')');
                $("#history-codes").empty();
                prizeL1=responseText[0];
                prizeL2=responseText[1];

                $.each(responseText,
                    function() {
                        var divItem = creatediv(this);
                        divItem.appendTo($("#history-codes"));
                    });
                //更新下一期波动选择
                //refreshBdSelects();
            },
            complete: function() {
                //请求完成的处理
            },
            error: function() {
                //请求出错处理
                alert("加载失败");
            }
        })
    }
    var creatediv = function(_this) {
        //三星时判断组3还是组6
        var wan = _this.prize.charAt(0);
        var qian = _this.prize.charAt(1);
        var bai = _this.prize.charAt(2);
        var shi = _this.prize.charAt(3);
        var ge = _this.prize.charAt(4);

        var curGe = curPrize.charAt(4);
        var curShi = curPrize.charAt(3);
        var curBai = curPrize.charAt(2);
        var curQian = curPrize.charAt(1);
        var curWan = curPrize.charAt(0);

        var cur2Ge = prizeL2.prize.charAt(4);
        var cur2Shi = prizeL2.prize.charAt(3);
        var cur2Bai = prizeL2.prize.charAt(2);
        var cur2Qian = prizeL2.prize.charAt(1);
        var cur2Wan = prizeL2.prize.charAt(0);
        var isGeMatch = false;
        var isGeBdMatch = false;


        if(wfType =="ge") {
            if (isPreMatch) {
                if (cur2Ge == ge) {
                    isGeMatch = true;
                }else {
                    isPreMatch = false;
                }
            } else {
                if (curGe == ge) {
                    isPreMatch = true;
                }
            }
        }
        // if(wfType =="ge" && curGe == ge) {
        //	if (isPreMatch) {
        //	    isGeMatch = true;
        //	}
        //		isPreMatch = true;
        //  } else if(wfType =="shi" && curShi == shi) {
        //       isGeMatch = true;
        //   } else if(wfType =="bai" && curBai == bai) {
        //       isGeMatch = true;
        //   } else if(wfType =="qian" && curQian == qian) {
        //       isGeMatch = true;
        //   } else if(wfType =="wan" && curWan == wan) {
        //       isGeMatch = true;
        //   } else {
        //		isPreMatch = false;
        //	}

        var parentdiv = $('<div></div>');
        parentdiv.addClass('history-code-item'); //添加css样式
        var childdiv = $('<div></div>');
        childdiv.addClass('code-issue full-size');
        childdiv.text(_this.no.substring(9));
        childdiv.appendTo(parentdiv);
        isGeMatch = _this.isMatch == "Y";
        isGeBdMatch = _this.isBdMatch == "Y";
        if(isGeMatch) {
            childdiv.addClass('ge-active');
        }
        if(isGeBdMatch) {
            childdiv.addClass('gebd-active');
        }

        var childdiv2 = $('<div></div>');
        childdiv2.addClass('code-number full-size');
        childdiv2.appendTo(parentdiv);

        var spanChild = $('<span></span>');

        if(isGeMatch) {
            childdiv2.addClass('ge-active');
        }
        if(isGeBdMatch) {
            childdiv2.addClass('gebd-active');
        }
        spanChild.text(_this.prize);
        spanChild.appendTo(childdiv2);

        var childdiv3 = $('<div></div>');
        childdiv3.addClass('code-adjust full-size');
        childdiv3.appendTo(parentdiv);

        if(isGeMatch) {
            childdiv3.addClass('ge-active');
        }
        if(isGeBdMatch) {
            childdiv3.addClass('gebd-active');
        }
        var spanChild3 = $('<span></span>');
        spanChild3.text(_this.adjustNum);
        spanChild3.appendTo(childdiv3);

        return parentdiv;
    }

    function refreshMissedData() {
        var limit = $("#limitValue").val();
        $.ajax({
            url: staticUrl + "prize/getLatestGeNextPrize?lotteryCode=TXFFC&limit=" + limit + "&type=" + wfType + "&prizeType=" + prizeType,
            success: function(response) {
                //请求成功时处理
                //var responseText = eval('('+ response +')');
                $("#table").empty();
                creatediv2(response);
                //createColdTable(response);

            },
            complete: function() {
                //请求完成的处理
            },
            error: function() {
                //请求出错处理
                alert("加载失败");
            }
        })
    }
    var creatediv2 = function(_this) {

        for (var item in _this) {
            var parentTable = $('<table  border:solid 1px #add9c0; style="display:inline;margin:1px 32px;"></table>');

            var captionStr = '<caption style="font-size:50px;color:#FF0000">' + item + '</caption>';
            $(captionStr).appendTo(parentTable);
            parentTable.appendTo($('#table'));
            var thTr = $('<tr></tr>');
            $('<th>期号</th>').appendTo(thTr);
            $('<th>开奖</th>').appendTo(thTr);

            $('<th>单双</th>').appendTo(thTr);
            $('<th>大小</th>').appendTo(thTr);
            thTr.appendTo(parentTable);

            var curNumJson =  _this[item];
            $.each(curNumJson, function () {
                console.log(this.no);
                var dataTr = $('<tr></tr>');
                dataTr.appendTo(parentTable);
                $('<td>' + this.no.substring(9) + '</td>').appendTo(dataTr);
                $('<td>' + this.prize + '</td>').appendTo(dataTr);
                var dsStr = this.ge%2==0?"双":"单";
                var dxStr = this.ge > 4?"大":"小";

                $('<td>' + dsStr + '</td>').appendTo(dataTr);
                $('<td>' + dxStr + '</td>').appendTo(dataTr);
                //genDataTable(_detail, parentTable);
            });
        }
    }
    var playToastSound = function() {

        Tools.Mp3.toast();
    }
    var genDataTable = function(this2, parentTable) {
        $.each(this2,
            function() {
                var dataTr = $('<tr></tr>');
                dataTr.appendTo(parentTable);
                $('<td>' + this.no + '</td>').appendTo(dataTr);
                $('<td>' + this.prize + '</td>').appendTo(dataTr);
                $('<td>' + this.ge + '</td>').appendTo(dataTr);
                $('<td>' + this.ge + '</td>').appendTo(dataTr);
            });
    }



    var soundplayTime = Date.now();
    var curPrizeNo = "";
    function updatePrize() {
        $.ajax({
            url: staticUrl + "/gen/getLatestPrize?lotteryCode=TCFFC&signCode=ok&prizeType=" + prizeType,
            success: function(responseText) {
                //请求成功时处理
                //var responseText = eval('(' + responseText + ')');
                var no = responseText.no;
                var prize = responseText.prize;
                curPrize = prize;

                $("#prize").text("第" + no + "期  :  " + prize);
                if (curPrizeNo == "" || curPrizeNo != no) {
                    //更新开奖期号
                    curPrizeNo = no;
                    refreshPrizeHis();
                    refreshMissedData();

                    //播放语音
                    if (isSoundSwitchOn) {
                        var toSound = new Array();
                        for (var i = 0; i < 5; i++) {
                            toSound[i] = prize.charAt(i);
                        }
                        Tools.playNumber.play(toSound);
                    }
                }
            },
            complete: function() {
                //请求完成的处理
            },
            error: function() {
                //请求出错处理
                alert("加载失败");
            }
        })
    }
    var prizeInterval = function() {
        window.setInterval(updatePrize, 2000);
    }
    prizeInterval();

    var dataInterval;
    function autoUpdate_OnClick() {
        var isAutoUpdate = $("#autoUpdate").is(':checked');
        if (!isAutoUpdate) {
            clearInterval(dataInterval);
        } else {
            clearInterval(dataInterval);
            draw();
        }
    }

    var isSoundSwitchOn = false;
    function SoundSwitch_OnClick() {
        var isAutoUpdate = $("#soundSwitch").is(':checked');
        isSoundSwitchOn = isAutoUpdate;
    }

    function sleep(numberMillis) {
        var now = new Date();
        var exitTime = now.getTime() + numberMillis;
        while (true) {
            now = new Date();
            if (now.getTime() > exitTime) return;
        }
    }
    autoUpdate_OnClick();
    SoundSwitch_OnClick();
</script>
</body>

</html>
